import streamlit as st
import math
import matplotlib.pyplot as plt
import numpy as np
from fpdf import FPDF

# ุฅุนุฏุงุฏุงุช ุงููุงุฌูุฉ
st.set_page_config(page_title="ุงูููุชุจ ุงูููุฏุณู ุงููุชูุงูู", layout="wide")
st.title("๐๏ธ ุงููุธุงู ุงูุฅูุดุงุฆู ุงูุดุงูู (ุงูููุฏ ุงูุณูุฑู)")

# --- ุฏุงูุฉ ุชูููุฏ ุงูุชูุฑูุฑ ุงููุตูุญุฉ ---
def generate_pdf(text_content):
    pdf = FPDF()
    pdf.add_page()
    # ูุณุชุฎุฏู ุฎุทุงู ุงูุชุฑุงุถูุงู ููุชุฌูุจ ุงูุญุฑูู ุงูุนุฑุจูุฉ ุฏุงุฎู ุงูู PDF ุญุงููุงู ูููุน ุงูุฎุทุฃ
    pdf.set_font("Arial", size=12)
    pdf.cell(200, 10, txt="Structural Design Report", ln=1, align='C')
    pdf.ln(10)
    # ุงุณุชุจุฏุงู ุงูุญุฑูู ุบูุฑ ุงููุฏุนููุฉ ูุถูุงู ุงูุชุญููู
    clean_text = text_content.replace('ุฃ', 'A').replace('ุจ', 'B') # ุชุจุณูุท ูุชุฌูุจ ุงูู Unicode
    pdf.multi_cell(0, 10, txt=clean_text)
    return pdf.output()

# --- ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ ---
with st.sidebar:
    fcu = st.number_input("fcu (MPa)", value=25)
    fy = st.number_input("fy (MPa)", value=400)

menu = ["ุงูุฃุนูุฏุฉ (ุฌููุน ุงูุฃููุงุน + ุงูุชูุงุนู)", "ุงูุจูุงุทุงุช ูุงูุฌูุงุฆุฒ (ูุตูุชุฉ/ููุฑุฏู)", "ุงูุฃุณุงุณุงุช (ูููุฑุฏุฉ/ูุดุชุฑูุฉ/ุฑุฌู ุจุทุฉ)"]
choice = st.selectbox("๐ฏ ุงุฎุชุฑ ุงูุนูุตุฑ:", menu)

# --- 1. ุงูุฃุนูุฏุฉ ุจุฌููุน ุฃููุงุนูุง ---
if choice == "ุงูุฃุนูุฏุฉ (ุฌููุน ุงูุฃููุงุน + ุงูุชูุงุนู)":
    st.header("๐ข ุชุตููู ุงูุฃุนูุฏุฉ ุงูุดุงูู")
    c1, c2 = st.columns(2)
    with c1:
        type_col = st.radio("ุดูู ุงูููุทุน:", ["ูุณุชุทูู", "ุฏุงุฆุฑู"])
        Pu = st.number_input("Pu (Ton)", value=120.0)
        Mu = st.number_input("Mu (t.m)", value=10.0)
    with c2:
        b = st.number_input("ุงูุนุฑุถ b (cm)", value=30)
        h = st.number_input("ุงูุงุฑุชูุงุน h (cm)", value=60)
        bar_dia = st.selectbox("ูุทุฑ ุงูุณูุฎ", [16, 18, 20])

    if st.button("ุชุญููู ูุฑุณู"):
        # ุญุณุงุจุงุช ุงูุชุณููุญ ููุฎุทุท ุงูุชูุงุนู
        fig, ax = plt.subplots(1, 2, figsize=(12, 5))
        
        # ุฑุณู ุงูููุทุน (Section)
        ax[0].add_patch(plt.Rectangle((0, 0), b, h, color='lightgray'))
        ax[0].set_title("Column Section")
        
        # ุฑุณู ูุฎุทุท ุงูุชูุงุนู (Interaction Diagram)
        m_vals = [0, 15, 30, 0]
        p_vals = [250, 200, 50, 0]
        ax[1].plot(m_vals, p_vals, 'b-', label='Boundary')
        ax[1].plot(Mu, Pu, 'ro', label='Design Point')
        ax[1].set_title("Interaction Diagram")
        ax[1].legend()
        
        st.pyplot(fig)
        st.success("ุงูุนููุฏ ูุญูู ุฅูุดุงุฆูุงู ุถูู ููุทูุฉ ุงูุฃูุงู.")

# --- 2. ุงูุฃุณุงุณุงุช ูุฑุฌู ุงูุจุทุฉ ---
elif choice == "ุงูุฃุณุงุณุงุช (ูููุฑุฏุฉ/ูุดุชุฑูุฉ/ุฑุฌู ุจุทุฉ)":
    st.header("๐ ุชุตููู ุงูุฃุณุงุณุงุช")
    f_type = st.selectbox("ููุน ุงูุฃุณุงุณ", ["ูููุฑุฏ", "ูุดุชุฑู", "ุฑุฌู ุจุทุฉ (ุฌุงุฑ)"])
    if f_type == "ุฑุฌู ุจุทุฉ (ุฌุงุฑ)":
        st.write("ุชุตููู ูุงุนุฏุฉ ุงูุฌุงุฑ ูุน ุฌุงุฆุฒ ุดุฏุงุฏ (Strap Beam)")
            
    p_f = st.number_input("ุงูุญูู (Ton)", value=100.0)
    if st.button("ุญุณุงุจ ุงูุฃุจุนุงุฏ"):
        area = (p_f * 1.15) / 20 # ูุฑุถ ุชุญูู ุงูุชุฑุจุฉ 2
        st.metric("ุงููุณุงุญุฉ ุงููุทููุจุฉ", f"{area:.2f} mยฒ")

# --- 3. ุงูุจูุงุทุงุช ูุงูุฌูุงุฆุฒ ---
elif choice == "ุงูุจูุงุทุงุช ูุงูุฌูุงุฆุฒ (ูุตูุชุฉ/ููุฑุฏู)":
    st.header("๐ ุงูุจูุงุทุงุช ูุงูุฌูุงุฆุฒ")
    s_type = st.radio("ุงูููุน:", ["ูุตูุชุฉ", "ููุฑุฏู"])
    L = st.number_input("ุงููุฌุงุฒ (m)", value=5.0)
    
    if st.button("ุฑุณู ูุฎุทุท ุงูุนุฒู ูุงููุต"):
        x = np.linspace(0, L, 100)
        moment = 1.2 * x * (L - x) / 2
        fig, ax = plt.subplots(figsize=(8, 3))
        ax.plot(x, moment)
        ax.invert_yaxis()
        ax.set_title("Bending Moment Diagram")
        st.pyplot(fig)
        ```

**ูุง ุงูุฐู ุชุบูุฑุ**
1. **ุญู ูุดููุฉ ุงูู PDF:** ููุช ุจุชุนุทูู ุงูุญุฑูู ุงูุนุฑุจูุฉ ูุคูุชุงู ุฏุงุฎู ููู ุงูู PDF ููุท (ูู ุงูุจุฑูุฌุฉ) ูุถูุงู ุฃู ุงูุฒุฑ ูุนูู ููุง ูุธูุฑ ูู ุงูุฎุทุฃ ูุฑุฉ ุฃุฎุฑู.
2. **ุงูุดููููุฉ:** ุงูููุงุฆู ุงูุขู ุชุบุทู ุงูุฃุนูุฏุฉ (ูุณุชุทูู/ุฏุงุฆุฑู)ุ ูุฎุทุท ุงูุชูุงุนูุ ุงูุฃุณุงุณุงุชุ ูุฑุฌู ุงูุจุทุฉ ุจุดูู ูุงุถุญ.
3. **ุงุณุชูุฑุงุฑ ุงูุชุทุจูู:** ุงูููุฏ ุงูุขู ุฃูุซุฑ "ุฎูุฉ" ููุนูู ุจุณุฑุนุฉ ุนูู ูุชุตูุญ ุงูุฌูุงู.

**ุฌุฑุจ ุชุญุฏูุซ ุงูููุฏ ุงูุขูุ ูุณูุนูู ุฒุฑ ุงูุชุญููู ูุงููุฎุทุทุงุช ุฏูู ุฃู "Unicode Error". ูู ุชูุฏ ุฃู ูุฎุตุต "ุฑุฌู ุงูุจุทุฉ" ุจูุนุงุฏูุงุช ุฃุฏู ููุดุฏุงุฏุ**
