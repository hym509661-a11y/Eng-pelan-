import streamlit as st
import math
import matplotlib.pyplot as plt
import numpy as np

# ุฅุนุฏุงุฏุงุช ุงููุงุฌูุฉ ุงูุงุญุชุฑุงููุฉ
st.set_page_config(page_title="ุงูููุชุจ ุงูููุฏุณู ุงูุณูุฑู ุงูุดุงูู", layout="wide")
st.title("๐๏ธ ุงูููุณูุนุฉ ุงูููุฏุณูุฉ ุงูุณูุฑูุฉ ุงููุชูุงููุฉ")
st.write("ุชุตููู ูุชุญููู: ุจูุงุทุงุช (ูุตูุชุฉ/ููุฑุฏู) - ุฃุนูุฏุฉ - ุฃุณุงุณุงุช (ูููุฑุฏุฉ/ูุดุชุฑูุฉ/ุญุตูุฑุฉ)")

# --- ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ: ููุงุตูุงุช ุงูููุฏ ุงูุณูุฑู ---
with st.sidebar:
    st.header("๐ ููุงุตูุงุช ุงูููุฏ ุงูุนุฑุจู ุงูุณูุฑู")
    fcu = st.number_input("ุฅุฌูุงุฏ ุงูุจูุชูู fcu (MPa)", value=25)
    fy = st.number_input("ุฅุฌูุงุฏ ุงูุญุฏูุฏ fy (MPa)", value=400)
    st.divider()
    st.info("ุงููุนุงุฏูุงุช ูุจุฑูุฌุฉ ููู ููุญู ุงูููุฏ ุงูุณูุฑู ูุนุงู 2024")

# --- ุงููุงุฆูุฉ ุงูุฑุฆูุณูุฉ ููุนูุงุตุฑ ุงูุฅูุดุงุฆูุฉ ---
menu = [
    "1. ุงูุจูุงุทุงุช ุงููุตูุชุฉ (Solid Slabs)",
    "2. ุงูุจูุงุทุงุช ุงูููุฑุฏู (Ribbed Slabs)",
    "3. ุงูุฃุนูุฏุฉ ุงููุญูุฑูุฉ (Columns)",
    "4. ุงูุฃุณุงุณุงุช ุงููููุฑุฏุฉ ูุงููุดุชุฑูุฉ",
    "5. ุฃุณุงุณุงุช ุงูุฌูุงุฑ (ุฑุฌู ุงูุจุทุฉ - Strap)",
    "6. ุงูุญุตูุฑุฉ ุงูุนุงูุฉ (Raft Foundation)"
]
choice = st.selectbox("๐ฏ ุงุฎุชุฑ ุงูุนูุตุฑ ุงููุฑุงุฏ ุชุตูููู:", menu)

# ---------------------------------------------------------
# 1. ุงูุจูุงุทุงุช ุงููุตูุชุฉ (ูุน ุงูุฑุณู ูุงููุฑุด ูุงูุบุทุงุก)
# ---------------------------------------------------------
if choice == "1. ุงูุจูุงุทุงุช ุงููุตูุชุฉ (Solid Slabs)":
    st.header("๐ ุชุตููู ุงูุจูุงุทุงุช ุงููุตูุชุฉ")
    col1, col2 = st.columns(2)
    with col1:
        L = st.number_input("ุงููุฌุงุฒ L (m)", value=4.0)
        t_cm = st.number_input("ุงูุณูุงูุฉ h (cm)", value=12)
    with col2:
        bar_dia = st.selectbox("ูุทุฑ ุงูุญุฏูุฏ (mm)", [8, 10, 12, 14])
        live_load = st.number_input("ุงูุญูููุฉ ุงูุญูุฉ (kg/mยฒ)", value=200)

    if st.button("ุญุณุงุจ ูุฑุณู ุงูุชูุงุตูู"):
        wu = 1.4*(t_cm/100*2.5 + 0.15) + 1.7*(live_load/1000)
        Mu = (wu * L**2) / 8
        d = (t_cm - 2.5)*10
        As = max((Mu*10**7)/(0.8*fy*d), 0.0018*1000*t_cm*10) / 100
        n_bars = math.ceil(As / (math.pi*bar_dia**2/400))
        n_bars = max(n_bars, 5)
        
        st.success(f"๐จ ุงูุชุณููุญ: {n_bars} T{bar_dia} / ู.ุท (ูุฑุด)")
        st.info(f"ุงููุณุงูุฉ ุจูู ุงููุถุจุงู: {100/n_bars:.1f} ุณู")
        
        # ุฑุณู ุชูุฑูุฏ ุงูุญุฏูุฏ
        fig, ax = plt.subplots(figsize=(8, 2))
        ax.plot([0, L], [0, 0], 'grey', lw=10) # ุงูููุทุน
        ax.plot([0.05, L-0.05], [-0.1, -0.1], 'red', lw=3, label="ุงูุญุฏูุฏ") # ุงูุณูุฎ
        ax.set_title("ุชูุฑูุฏ ุญุฏูุฏ ุงูุจูุงุทุฉ (ูุฑุด)")
        st.pyplot(fig)

# ---------------------------------------------------------
# 2. ุงูุจูุงุทุงุช ุงูููุฑุฏู (Ribbed Slabs)
# ---------------------------------------------------------
elif choice == "2. ุงูุจูุงุทุงุช ุงูููุฑุฏู (Ribbed Slabs)":
    st.header("๐งฑ ุชุตููู ุงูุจูุงุทุฉ ุงูููุฑุฏู (ุงูุฃุนุตุงุจ)")
    col1, col2 = st.columns(2)
    with col1:
        L_rib = st.number_input("ุทูู ุงูุนุตุจ (m)", value=5.0)
        b_rib = st.number_input("ุนุฑุถ ุงูุนุตุจ (cm)", value=12)
    with col2:
        h_rib = st.number_input("ุงูุงุฑุชูุงุน ุงูููู (cm)", value=30)
        spacing = st.number_input("ุงููุณุงูุฉ ุจูู ุงููุญุงูุฑ (cm)", value=52)

    if st.button("ุชุตููู ุงูุนุตุจ"):
        wu_rib = 0.6 # ุญูููุฉ ุชูุฏูุฑูุฉ ููุนุตุจ
        Mu_rib = (wu_rib * L_rib**2) / 8
        st.success(f"ุงูุนุฒู ุนูู ุงูุนุตุจ: {Mu_rib:.2f} t.m")
        st.info("ุงูุชุณููุญ ุงูููุชุฑุญ ููุนุตุจ: 2 T14 ุณููู + 1 T10 ุนููู")

# ---------------------------------------------------------
# 4. ุงูุฃุณุงุณุงุช ุงููุดุชุฑูุฉ ูุงููููุฑุฏุฉ
# ---------------------------------------------------------
elif choice == "4. ุงูุฃุณุงุณุงุช ุงููููุฑุฏุฉ ูุงููุดุชุฑูุฉ":
    type_f = st.radio("ููุน ุงูุฃุณุงุณ:", ["ูููุฑุฏ", "ูุดุชุฑู (ูุนููุฏูู)"])
    p1 = st.number_input("ุญูู ุงูุนููุฏ ุงูุฃูู (Ton)", value=100.0)
    q_soil = st.number_input("ุชุญูู ุงูุชุฑุจุฉ (kg/cmยฒ)", value=2.0)
    
    if st.button("ุญุณุงุจ ุงูุฃุจุนุงุฏ"):
        area = (p1 * 1.15) / (q_soil * 10)
        st.success(f"ุงููุณุงุญุฉ ุงููุทููุจุฉ ููุฃุณุงุณ: {area:.2f} mยฒ")
        st.info(f"ุงูุจุนุฏ ุงูุชูุฑูุจู: {math.sqrt(area):.2f} ู")

# ---------------------------------------------------------
# 5. ุฃุณุงุณุงุช ุงูุฌูุงุฑ (ุฑุฌู ุงูุจุทุฉ)
# ---------------------------------------------------------
elif choice == "5. ุฃุณุงุณุงุช ุงูุฌูุงุฑ (ุฑุฌู ุงูุจุทุฉ - Strap)":
    st.header("๐ ุชุตููู ุฃุณุงุณ ุงูุฌุงุฑ (Strap Footing)")
    st.write("ูุณุชุฎุฏู ุนูุฏ ูุฌูุฏ ุนููุฏ ุนูู ุญุฏูุฏ ุงูุฃุฑุถ (ุฑุฌู ุงูุจุทุฉ)")
    p_edge = st.number_input("ุญูู ุนููุฏ ุงูุฌุงุฑ (Ton)", value=80.0)
    dist = st.number_input("ุงููุณุงูุฉ ููุนููุฏ ุงูุฏุงุฎูู (m)", value=5.0)
    
    if st.button("ุชุญููู ุฃุณุงุณ ุงูุฌุงุฑ"):
        st.warning("โ๏ธ ูุฌุจ ุชูููุฐ ุฌุงุฆุฒ ุดุฏุงุฏ (Strap Beam) ูุฑุจุท ุนููุฏ ุงูุฌุงุฑ ุจุงูุนููุฏ ุงูุฏุงุฎูู.")
        st.info(f"ุฑุฏ ุงููุนู ุงูุฅุถุงูู ุงููุชููุน ุจุณุจุจ ุงููุงูุฑูุฒูุฉ: {p_edge*0.2:.2f} Ton")

# ---------------------------------------------------------
# 6. ุงูุญุตูุฑุฉ ุงูุนุงูุฉ (Raft Foundation)
# ---------------------------------------------------------
elif choice == "6. ุงูุญุตูุฑุฉ ุงูุนุงูุฉ (Raft Foundation)":
    st.header("๐๏ธ ุชุตููู ุงูุญุตูุฑุฉ ุงูุนุงูุฉ (Raft)")
    total_loads = st.number_input("ูุฌููุน ุฃุญูุงู ูุงูุฉ ุงูุฃุนูุฏุฉ (Ton)", value=2000.0)
    area_raft = st.number_input("ูุณุงุญุฉ ุงูุญุตูุฑุฉ ุงููููุฉ (mยฒ)", value=300.0)
    
    if st.button("ุชุญูู ูู ุงูุญุตูุฑุฉ"):
        stress = (total_loads * 1.1) / area_raft
        st.metric("ุงูุฅุฌูุงุฏ ุนูู ุงูุชุฑุจุฉ", f"{stress:.2f} t/mยฒ")
        st.success(f"ุงูุณูุงูุฉ ุงูููุชุฑุญุฉ ููุญุตูุฑุฉ: {total_loads/120:.0f} ุณู")

# --- ููุฒุฉ ุงุณุชุฎุฑุงุฌ ุงูุชูุฑูุฑ ---
st.divider()
if st.button("๐ ุชูููุฏ ุงููุฐูุฑุฉ ุงูุญุณุงุจูุฉ"):
    report = f"ุชูุฑูุฑ ุฅูุดุงุฆู - ุงูููุฏ ุงูุณูุฑู\nุงูุนูุตุฑ: {choice}\nfcu: {fcu} MPa\nfy: {fy} MPa\nุชู ุงูุญุณุงุจ ุจูุฌุงุญ."
    st.text_area("ุงูุณุฎ ุงููุชุงุฆุฌ ูู ููุง:", report)
