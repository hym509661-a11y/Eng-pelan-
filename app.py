import streamlit as st
import math
import matplotlib.pyplot as plt
import numpy as np

# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙØ­Ø©
st.set_page_config(page_title="Ø§Ù„Ù…ÙƒØªØ¨ Ø§Ù„Ù‡Ù†Ø¯Ø³ÙŠ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„", layout="wide")

# --- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© (Ø§Ù„Ù…ÙˆØ§Ø¯) ---
with st.sidebar:
    st.title("ğŸ—ï¸ Ø§Ù„Ù…ÙƒØªØ¨ Ø§Ù„Ù‡Ù†Ø¯Ø³ÙŠ")
    st.header("ğŸ“‹ Ù…ÙˆØ§ØµÙØ§Øª Ø§Ù„Ù…ÙˆØ§Ø¯")
    fcu = st.number_input("Ø¥Ø¬Ù‡Ø§Ø¯ Ø§Ù„Ø¨ÙŠØªÙˆÙ† fcu (MPa)", value=25)
    fy = st.number_input("Ø¥Ø¬Ù‡Ø§Ø¯ Ø§Ù„Ø­Ø¯ÙŠØ¯ fy (MPa)", value=400)
    st.divider()
    st.info("Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª ÙˆÙÙ‚ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø§Ù„Ø³ÙˆØ±ÙŠ")

# --- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ---
choice = st.selectbox("ğŸ¯ Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù…Ø±Ø§Ø¯ ØªØµÙ…ÙŠÙ…Ù‡:", 
                     ["Ø¨Ù„Ø§Ø·Ø§Øª Ù…ØµÙ…ØªØ© (Solid Slabs)", 
                      "Ø£Ø¹Ù…Ø¯Ø© Ù…Ø­ÙˆØ±ÙŠØ© (Columns)", 
                      "Ø¬ÙˆØ§Ø¦Ø² Ø¨ÙŠØªÙˆÙ†ÙŠØ© (Beams)", 
                      "Ø£Ø³Ø§Ø³Ø§Øª Ù…Ù†ÙØ±Ø¯Ø© (Isolated Footings)"])

# ---------------------------------------------------------
# 1. Ù‚Ø³Ù… Ø§Ù„Ø¨Ù„Ø§Ø·Ø§Øª Ø§Ù„Ù…ØµÙ…ØªØ©
# ---------------------------------------------------------
if choice == "Ø¨Ù„Ø§Ø·Ø§Øª Ù…ØµÙ…ØªØ© (Solid Slabs)":
    st.header("ğŸ“Š ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¨Ù„Ø§Ø·Ø§Øª ÙˆØ§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø³Ù‡Ù…")
    col1, col2 = st.columns(2)
    with col1:
        L = st.number_input("Ø§Ù„Ù…Ø¬Ø§Ø² Ø§Ù„ØµØ§ÙÙŠ L (m)", value=4.0)
        t_cm = st.number_input("Ø³Ù…Ø§ÙƒØ© Ø§Ù„Ø¨Ù„Ø§Ø·Ø© h (cm)", value=12)
        condition = st.selectbox("Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø³ØªÙ†Ø§Ø¯", ["Ø¨Ø³ÙŠØ·Ø©", "Ù…Ø³ØªÙ…Ø±Ø© Ù…Ù† Ø·Ø±Ù", "Ù…Ø³ØªÙ…Ø±Ø© Ù…Ù† Ø·Ø±ÙÙŠÙ†", "Ø¸ÙØ±"])
    with col2:
        loads = st.number_input("Ø§Ù„Ø­Ù…ÙˆÙ„Ø© Ø§Ù„Ø­ÙŠØ© + Ø§Ù„ØªØºØ·ÙŠØ© (kg/mÂ²)", value=400)
        bar_dia = st.selectbox("Ù‚Ø·Ø± Ø§Ù„Ø­Ø¯ÙŠØ¯ (mm)", [8, 10, 12])

    if st.button("ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨Ù„Ø§Ø·Ø©"):
        # Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ù‡Ù… ÙˆØ§Ù„Ø£Ø­Ù…Ø§Ù„
        min_t = (L * 100) / ({"Ø¨Ø³ÙŠØ·Ø©": 20, "Ù…Ø³ØªÙ…Ø±Ø© Ù…Ù† Ø·Ø±Ù": 24, "Ù…Ø³ØªÙ…Ø±Ø© Ù…Ù† Ø·Ø±ÙÙŠÙ†": 28, "Ø¸ÙØ±": 10}[condition])
        wu = 1.4 * (t_cm/100 * 2.5 + 0.2) + 1.7 * (loads/1000)
        Mu = (wu * L**2) / 8
        
        # Ø§Ù„ØªØ³Ù„ÙŠØ­
        d = (t_cm - 2.5) * 10
        Rn = (Mu * 10**7) / (1000 * d**2)
        m = fy / (0.85 * fcu)
        rho = (1/m) * (1 - math.sqrt(1 - (2 * m * Rn / fy))) if (1 - (2 * m * Rn / fy)) > 0 else 0.0018
        As = max(rho * 1000 * d, 0.0018 * 1000 * t_cm * 10) / 100
        n_bars = math.ceil(As / (math.pi * bar_dia**2 / 400))
        
        st.success(f"Ø§Ù„Ù†ØªÙŠØ¬Ø©: {max(n_bars, 5)} T{bar_dia} / m")
        if t_cm < min_t: st.error(f"âš ï¸ Ø§Ù„Ø³Ù‡Ù… ØºÙŠØ± Ù…Ø­Ù‚Ù‚ (Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ {min_t:.1f} Ø³Ù…)")

# ---------------------------------------------------------
# 2. Ù‚Ø³Ù… Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©
# ---------------------------------------------------------
elif choice == "Ø£Ø¹Ù…Ø¯Ø© Ù…Ø­ÙˆØ±ÙŠØ© (Columns)":
    st.header("ğŸ¢ ØªØµÙ…ÙŠÙ… Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ù…Ø­ÙˆØ±ÙŠØ©")
    p_load = st.number_input("Ø§Ù„Ø­Ù…Ù„ Ø§Ù„Ù…Ø­ÙˆØ±ÙŠ (Ton)", value=150.0)
    col1, col2 = st.columns(2)
    with col1:
        b = st.number_input("Ø§Ù„Ø¹Ø±Ø¶ b (cm)", value=30)
    with col2:
        h = st.number_input("Ø§Ù„Ø·ÙˆÙ„ h (cm)", value=60)
    
    if st.button("ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¹Ù…ÙˆØ¯"):
        Ag = b * h * 100
        Pu = 1.5 * p_load * 10000
        As_req = (Pu - 0.4 * fcu * Ag) / (0.67 * fy - 0.4 * fcu)
        As_final = max(As_req, 0.008 * Ag)
        st.info(f"Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©: {As_final/100:.2f} cmÂ²")
        st.success(f"Ø§Ù„ØªØ³Ù„ÙŠØ­ Ø§Ù„Ù…Ù‚ØªØ±Ø­: {math.ceil(As_final/201)*2 if As_final>0 else 4} T16")

# ---------------------------------------------------------
# 3. Ù‚Ø³Ù… Ø§Ù„Ø¬ÙˆØ§Ø¦Ø² (Beams)
# ---------------------------------------------------------
elif choice == "Ø¬ÙˆØ§Ø¦Ø² Ø¨ÙŠØªÙˆÙ†ÙŠØ© (Beams)":
    st.header("ğŸŒ‰ ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¬ÙˆØ§Ø¦Ø² Ø§Ù„Ø¨ÙŠØªÙˆÙ†ÙŠØ©")
    Mu_beam = st.number_input("Ø§Ù„Ø¹Ø²Ù… Ø§Ù„ØªØµÙ…ÙŠÙ…ÙŠ Mu (t.m)", value=15.0)
    b_beam = st.number_input("Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø§Ø¦Ø² (cm)", value=30)
    h_beam = st.number_input("Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø¬Ø§Ø¦Ø² (cm)", value=60)
    
    if st.button("Ø­Ø³Ø§Ø¨ ØªØ³Ù„ÙŠØ­ Ø§Ù„Ø¬Ø§Ø¦Ø²"):
        d_b = (h_beam - 5) * 10
        Rn_b = (Mu_beam * 10**7) / (b_beam * 10 * d_b**2)
        m_b = fy / (0.85 * fcu)
        rho_b = (1/m_b) * (1 - math.sqrt(1 - (2 * m_b * Rn_b / fy)))
        st.success(f"Ø§Ù„Ø­Ø¯ÙŠØ¯ Ø§Ù„Ø³ÙÙ„ÙŠ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: {rho_b * b_beam * 10 * d_b / 100:.2f} cmÂ²")

# ---------------------------------------------------------
# 4. Ù‚Ø³Ù… Ø§Ù„Ø£Ø³Ø§Ø³Ø§Øª (Footings)
# ---------------------------------------------------------
elif choice == "Ø£Ø³Ø§Ø³Ø§Øª Ù…Ù†ÙØ±Ø¯Ø© (Isolated Footings)":
    st.header("ğŸ—ï¸ ØªØµÙ…ÙŠÙ… Ø§Ù„Ø£Ø³Ø§Ø³Ø§Øª Ø§Ù„Ù…Ù†ÙØ±Ø¯Ø©")
    p_footing = st.number_input("Ø­Ù…Ù„ Ø§Ù„Ø¹Ù…ÙˆØ¯ (Ton)", value=120.0)
    q_soil = st.number_input("ØªØ­Ù…Ù„ Ø§Ù„ØªØ±Ø¨Ø© Ø§Ù„Ù…Ø³Ù…ÙˆØ­ (kg/cmÂ²)", value=2.0)
    
    if st.button("Ø­Ø³Ø§Ø¨ Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„Ø£Ø³Ø§Ø³"):
        area_req = (p_footing * 1.1) / (q_soil * 10)
        side = math.sqrt(area_req)
        st.success(f"Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©: {side:.2f} m x {side:.2f} m")
        st.info(f"Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©: {area_req:.2f} mÂ²")

